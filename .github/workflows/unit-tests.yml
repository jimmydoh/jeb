name: Unit Tests

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
  workflow_dispatch:

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install pytest
      
      - name: Run unit tests
        run: |
          # Run pure unit tests (excluding performance and integration tests)
          # Track test results
          success_count=0
          fail_count=0
          failed_tests=""
          
          echo "============================================================"
          echo "Running Pure Unit Tests"
          echo "============================================================"
          echo ""
          
          for test in tests/test_*.py; do
            # Skip performance and integration tests
            if [[ "$test" == *"performance"* ]] || [[ "$test" == *"integration"* ]]; then
              continue
            fi
            
            echo "Running $(basename $test)..."
            if python3 "$test" 2>&1; then
              echo "  ✓ PASS"
              success_count=$((success_count + 1))
            else
              echo "  ✗ FAIL"
              if [ -z "$failed_tests" ]; then
                failed_tests="$(basename $test)"
              else
                failed_tests="$failed_tests"$'\n'"$(basename $test)"
              fi
              fail_count=$((fail_count + 1))
            fi
            echo ""
          done
          
          echo "============================================================"
          echo "Test Summary"
          echo "============================================================"
          echo "Passed: $success_count"
          echo "Failed: $fail_count"
          
          if [ -n "$failed_tests" ]; then
            echo ""
            echo "Failed tests:"
            echo "$failed_tests"
            exit 1
          fi
          
          echo ""
          echo "✓ All unit tests passed!"
